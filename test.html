Sub SaveEmailsAsPDF()
    Dim OutlookApp As Object
    Dim OutlookNamespace As Object
    Dim OutlookFolder As Object
    Dim OutlookMail As Object
    Dim SubjectKeyword As String
    Dim SavePath As String
    Dim ReceivedDate As Date
    
    ' 変数設定
    SubjectKeyword = "◯◯" ' 件名に含まれるキーワード
    SavePath = "C:\EmailsPDF\" ' PDFを保存するフォルダ
    ReceivedDate = Date ' 本日の日付
    
    ' Outlookアプリケーションを取得
    On Error Resume Next
    Set OutlookApp = GetObject(, "Outlook.Application")
    If OutlookApp Is Nothing Then
        Set OutlookApp = CreateObject("Outlook.Application")
    End If
    On Error GoTo 0
    
    ' Outlookの受信トレイを取得
    Set OutlookNamespace = OutlookApp.GetNamespace("MAPI")
    Set OutlookFolder = OutlookNamespace.GetDefaultFolder(6) ' 6 = 受信トレイ
    
    ' 受信トレイのメールをループ
    For Each OutlookMail In OutlookFolder.Items
        If OutlookMail.ReceivedTime >= ReceivedDate And OutlookMail.ReceivedTime < (ReceivedDate + 1) Then
            If InStr(OutlookMail.Subject, SubjectKeyword) > 0 Then
                ' メールをPDFとして保存
                SaveEmailAsPDF OutlookMail, SavePath
            End If
        End If
    Next OutlookMail
    
    ' 後処理
    Set OutlookMail = Nothing
    Set OutlookFolder = Nothing
    Set OutlookNamespace = Nothing
    Set OutlookApp = Nothing
    
    MsgBox "処理が完了しました。", vbInformation
End Sub

Sub SaveEmailAsPDF(OutlookMail As Object, SavePath As String)
    Dim WordDoc As Object
    Dim TempFilePath As String
    Dim PDFFilePath As String
    
    ' 一時的なWordファイルのパス
    TempFilePath = Environ("TEMP") & "\TempEmail.doc"
    PDFFilePath = SavePath & Format(OutlookMail.ReceivedTime, "yyyymmdd_HHMMSS") & ".pdf"
    
    ' メールをWord形式で保存
    OutlookMail.SaveAs TempFilePath, 0 ' 0 = Word形式
    
    ' Wordを開いてPDFに変換
    On Error Resume Next
    Set WordApp = CreateObject("Word.Application")
    Set WordDoc = WordApp.Documents.Open(TempFilePath)
    WordDoc.ExportAsFixedFormat PDFFilePath, 17 ' 17 = PDF形式
    WordDoc.Close False
    WordApp.Quit
    On Error GoTo 0
    
    ' 一時ファイルを削除
    Kill TempFilePath
    
    ' 後処理
    Set WordDoc = Nothing
    Set WordApp = Nothing
End Sub

以下は、都道府県の選択を追加するために変更した箇所を明示しつつ、説明を追加したバージョンです。


---

1. index.html の変更点

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>相談受付</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        form, table {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
    </style>
    
    <!-- 変更箇所1: prefectures.js を読み込む -->
    <script src="prefectures.js" defer></script>
    
    <script>
        // 変更箇所2: ページロード時に都道府県の選択肢を生成
        document.addEventListener("DOMContentLoaded", () => {
            const prefectureSelect = document.getElementById("prefecture");
            
            // prefectures.js の都道府県リストを利用してドロップダウンを生成
            prefectures.forEach(pref => {
                const option = document.createElement("option");
                option.value = pref;
                option.textContent = pref;
                prefectureSelect.appendChild(option);
            });

            // 保存データの読み込み
            loadEntries();
        });

        const DB_KEY = "consultationData";

        // データを追加
        function addEntry() {
            const name = document.getElementById("name").value.trim();
            const prefecture = document.getElementById("prefecture").value;
            const phone = document.getElementById("phone").value.trim();
            const topic = document.getElementById("topic").value.trim();

            if (!name || !prefecture || !phone || !topic) {
                alert("すべてのフィールドを入力してください。");
                return;
            }

            const data = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            data.push({ name, prefecture, phone, topic });
            localStorage.setItem(DB_KEY, JSON.stringify(data));

            document.getElementById("consultationForm").reset();
            loadEntries();
        }

        // データを表示
        function loadEntries() {
            const entriesElement = document.getElementById("entries");
            entriesElement.innerHTML = "";

            const data = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            data.forEach((entry, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${entry.name}</td>
                    <td>${entry.prefecture}</td>
                    <td>${entry.phone}</td>
                    <td>${entry.topic}</td>
                    <td><button onclick="deleteEntry(${index})">削除</button></td>
                `;
                entriesElement.appendChild(row);
            });
        }

        // データを削除
        function deleteEntry(index) {
            const data = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            data.splice(index, 1);
            localStorage.setItem(DB_KEY, JSON.stringify(data));
            loadEntries();
        }
    </script>
</head>
<body>
    <h1>相談受付システム</h1>
    <form id="consultationForm">
        <label for="name">名前:</label><br>
        <input type="text" id="name" name="name" required><br><br>

        <!-- 変更箇所3: 都道府県の選択フィールドを追加 -->
        <label for="prefecture">都道府県:</label><br>
        <select id="prefecture" name="prefecture" required>
            <option value="" disabled selected>選択してください</option>
        </select><br><br>

        <label for="phone">電話番号:</label><br>
        <input type="tel" id="phone" name="phone" required pattern="[0-9\-]+" placeholder="例: 090-1234-5678"><br><br>

        <label for="topic">相談内容:</label><br>
        <textarea id="topic" name="topic" required></textarea><br><br>

        <button type="button" onclick="addEntry()">追加</button>
    </form>

    <h2>受付一覧</h2>
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>名前</th>
                <th>都道府県</th>
                <th>電話番号</th>
                <th>相談内容</th>
                <th>削除</th>
            </tr>
        </thead>
        <tbody id="entries"></tbody>
    </table>
</body>
</html>


---

2. prefectures.js

// 都道府県リストを配列で定義
const prefectures = [
    "北海道", "青森県", "岩手県", "宮城県", "秋田県", "山形県", "福島県",
    "茨城県", "栃木県", "群馬県", "埼玉県", "千葉県", "東京都", "神奈川県",
    "新潟県", "富山県", "石川県", "福井県", "山梨県", "長野県", "岐阜県",
    "静岡県", "愛知県", "三重県", "滋賀県", "京都府", "大阪府", "兵庫県",
    "奈良県", "和歌山県", "鳥取県", "島根県", "岡山県", "広島県", "山口県",
    "徳島県", "香川県", "愛媛県", "高知県", "福岡県", "佐賀県", "長崎県",
    "熊本県", "大分県", "宮崎県", "鹿児島県", "沖縄県"
];


---

変更点一覧

変更箇所1: 都道府県リストを外部ファイル（prefectures.js）で管理

都道府県リストを外部ファイルに定義し、const prefecturesとして管理します。


変更箇所2: 動的に都道府県リストを生成

ページロード時（DOMContentLoaded）に都道府県の選択肢を生成する処理を追加しました。


変更箇所3: 都道府県の選択フィールドを追加

<select>タグを追加し、都道府県を選択できるようにしました。



---

使い方

1. index.html と prefectures.js を同じフォルダ内に保存。


2. ブラウザで index.html を開く。


3. 名前、都道府県（選択）、電話番号、相談内容を入力してデータを追加。



メリット

都道府県リストを外部ファイルで管理するため、コードの再利用性が向上。

入力ミスを防ぐため、都道府県を選択式に変更。


必要に応じてさらにカスタマイズできます！

