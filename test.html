

<!DOCTYPE html>
<html>
<head>
    <title>VBAコード表示</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
    <pre><code class="vb">
Sub SaveAttachmentsByDate()
    Dim olApp As Outlook.Application
    Dim olNamespace As Outlook.Namespace
    Dim olFolder As Outlook.MAPIFolder
    Dim olMail As Outlook.MailItem
    Dim i As Integer
    Dim inputDate As String
    Dim targetDate As Date
    Dim saveFolder As String

    ' ユーザーに日付を入力させる
    inputDate = InputBox("Enter the date (YYYY-MM-DD):", "Select Date")

    ' 入力された日付をDate型に変換
    If IsDate(inputDate) Then
        targetDate = CDate(inputDate)
    Else
        MsgBox "Invalid date format. Please enter a valid date.", vbExclamation
        Exit Sub
    End If

    ' ユーザーに保存先フォルダを入力させる
    saveFolder = InputBox("Enter the folder path to save attachments:", "Select Folder")

    ' フォルダパスの末尾にバックスラッシュを追加
    If Right(saveFolder, 1) <> "\" Then
        saveFolder = saveFolder & "\"
    End If

    ' Outlookアプリケーションと名前空間を取得
    Set olApp = New Outlook.Application
    Set olNamespace = olApp.GetNamespace("MAPI")
    Set olFolder = olNamespace.GetDefaultFolder(olFolderInbox)

    ' メールアイテムのループ
    For i = 1 To olFolder.Items.Count
        If TypeOf olFolder.Items(i) Is Outlook.MailItem Then
            Set olMail = olFolder.Items(i)

            ' メールの受信日をチェック
            If Int(olMail.ReceivedTime) = targetDate Then
                ' 添付ファイルを保存
                SaveMailAttachments olMail, saveFolder
            End If
        End If
    Next i

    ' 後処理
    Set olMail = Nothing
    Set olFolder = Nothing
    Set olNamespace = Nothing
    Set olApp = Nothing

    MsgBox "Attachments saved successfully.", vbInformation
End Sub

Sub SaveMailAttachments(mailItem As Outlook.MailItem, saveFolder As String)
    Dim olAttachment As Outlook.Attachment
    Dim j As Integer

    ' 添付ファイルのループ
    For j = 1 To mailItem.Attachments.Count
        Set olAttachment = mailItem.Attachments(j)
        ' 添付ファイルを保存
        olAttachment.SaveAsFile saveFolder & olAttachment.FileName
    Next j

    ' 後処理
    Set olAttachment = Nothing
End Sub

    
Sub SaveMailAsMsg(mailItem As Outlook.MailItem, saveFolder As String)
    Dim msgFileName As String

    ' ファイル名を作成
    msgFileName = saveFolder & Format(mailItem.ReceivedTime, "yyyy-mm-dd_hh-nn-ss") & "_" & mailItem.Subject & ".msg"
    
    ' ファイル名に使用できない文字を置換
    msgFileName = Replace(msgFileName, ":", "-")
    msgFileName = Replace(msgFileName, "\", "-")
    msgFileName = Replace(msgFileName, "/", "-")
    msgFileName = Replace(msgFileName, "?", "")
    msgFileName = Replace(msgFileName, "*", "")
    msgFileName = Replace(msgFileName, "<", "")
    msgFileName = Replace(msgFileName, ">", "")
    msgFileName = Replace(msgFileName, "|", "")
    msgFileName = Replace(msgFileName, Chr(34), "") ' ダブルクオーテーション
    
    ' メールを.msgファイルとして保存
    mailItem.SaveAs msgFileName, olMSG
End Sub
    
    
    </code></pre>
</body>
</html>
