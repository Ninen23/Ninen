

<!DOCTYPE html>
<html>
<head>
    <title>VBAコード表示</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
    <pre><code class="vb">
        https://docs.google.com/forms/d/e/1FAIpQLSeIh4xb9zK4WdOlAb89odJJWqrVLb5R3uAUHBsgspmxhIp5rw/viewform?usp=sharing
'https://docs.google.com/forms/d/e/1FAIpQLSdCzIJ61gt1h7QEXPrQNBvUy68Fze0uJScIa1e7FlZQ7hvs2g/viewform?usp=dialog
' Export解析シートフィルタリング結果
Sub 保管中の証拠物件一覧()
    Export "保管中の証拠物件一覧"
End Sub
https://docs.google.com/forms/d/e/1FAIpQLSc3tXsF7a6PGl_QaS_mH9HFQnESJ0uKGdCFYGTiT9m5YPMjXg/viewform?usp=dialog
Sub 対応中の解析要請一覧()
    Export "対応中の解析要請一覧"
End Sub
https://docs.google.com/forms/d/e/1FAIpQLSc3tXsF7a6PGl_QaS_mH9HFQnESJ0uKGdCFYGTiT9m5YPMjXg/viewform?usp=sharing
Sub 解析終了()
    Export "解析終了一覧"
End Sub

Sub 解析状況未着手()
    Export "未着手解析要請一覧"
End Sub

Sub Export(filter As String)
    Dim wb As Workbook
    Dim newBook As Workbook
    Dim sourceSheet As Worksheet
    Dim filteredDataRange As Range
    Dim filePath As String
    Dim openFlag As Boolean
    Dim sheetName As String
    Dim 活動実績ファイル名 As String
    'Dim 要請シート名 As String
    Dim 解析シート名 As String
    'Dim 支援シート名 As String

    

    活動実績ファイル名 = Range("G7").Value
    '要請シート名 = Range("G8").Value
    解析シート名 = Range("G9").Value
    '支援シート名 = Range("G10").Value
    filePath = ThisWorkbook.Path & "\" & 活動実績ファイル名

    ' ファイルが開いているか確認
    openFlag = False
    For Each wb In Workbooks
        If wb.Name = 活動実績ファイル名 Then
            openFlag = True
            Exit For
        End If
    Next
    If openFlag = True Then
        MsgBox 活動実績ファイル名 & "を閉じてから再度実行してください。", vbExclamation
        Exit Sub
    End If


    ' ファイル存在確認
    If Len(Dir(filePath)) = 0 Then
        MsgBox "活動実績ファイルが見つかりません: " & filePath, vbExclamation
        Exit Sub
    End If

    ' ファイルを開く
    Set wb = Workbooks.Open(filePath)


    ' シート存在確認
    On Error Resume Next
    Set sourceSheet = wb.Sheets(解析シート名)
    On Error GoTo 0
    If sourceSheet Is Nothing Then
        MsgBox "シートが見つかりません: " & 解析シート名, vbExclamation
        GoTo Cleanup
    End If


    ' フィルター処理
    On Error GoTo FilterError

    Select Case filter
        Case "保管中の証拠物件一覧"
            sourceSheet.Range("A1").AutoFilter Field:=5, Criteria1:="" '返却・消去していない
        Case "対応中の解析要請一覧"
            sourceSheet.Range("A1").AutoFilter Field:=8, Criteria1:="" '報告種提出日が空欄
        Case "解析終了一覧"
            sourceSheet.Range("A1").AutoFilter Field:=5, Criteria1:="<>" '消去返却済み
            sourceSheet.Range("A1").AutoFilter Field:=6, Criteria1:="<>" '報告書提出済み
        Case "未着手解析要請一覧"
            sourceSheet.Range("A1").AutoFilter Field:=5, Criteria1:="" '返却・消去していない
            sourceSheet.Range("A1").AutoFilter Field:=6, Criteria1:="" '報告書未提出"
            sourceSheet.Range("A1").AutoFilter Field:=61, Criteria1:="" '解析開始日なし"
        Case Else
            MsgBox "フィルター条件が不正です: " & filter, vbExclamation
            GoTo Cleanup
    End Select

    ' フィルタリング結果の範囲を取得
    Set filteredDataRange = sourceSheet.AutoFilter.Range.SpecialCells(xlCellTypeVisible)


    ' 新規ブック作成
    Set newBook = Workbooks.Add
    filteredDataRange.Copy Destination:=newBook.Sheets(1).Range("A1")


    MsgBox "処理が完了しました。", vbInformation
    
Cleanup:
    If Not wb Is Nothing Then wb.Close SaveChanges:=False
    If Not newBook Is Nothing Then newBook.Close SaveChanges:=False
    Exit Sub

FilterError:
    MsgBox "エラーが発生しました: " & Err.Description, vbCritical
    Resume Cleanup
End Sub



            </code></pre>
</body>
</html>
